[#ansibleinventory]
= Ansible Inventory

include::_attributes.adoc[]

[#introduction]
== Introduction

An inventory defines a collection of hosts that Ansible will manage. These hosts can also be assigned to groups, which can be managed collectively. Groups can contain child groups, and hosts can be members of multiple groups. The inventory can also set variables that apply to the hosts and groups that it defines.

Host inventories can be defined in two different ways. A static host inventory can be defined by a text file. A dynamic host inventory can be generated by a script or other program as needed, using external information providers.

Inventories are written using INI format. The simplest format is a plain text file with a bunch of hostnames:

```ini
lb1.example.com
lb2.example.com
web1.example.com
web2.example.com
192.168.1.123
mysql.example.com
```

In this case all ansible tasks executed using that inventory will be executed in all hosts with no exception. However, if we want to be able to limit the execution of ansible tasks to some of the hosts we can use groups:

```ini
[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb1.example.com
lb2.example.com

[web-servers]
web1.example.com
web2.example.com
192.168.1.123
192.168.1.124
192.168.1.125

[db-servers]
mysql.example.com
```

IMPORTANT: Ansible provides a default inventory in **/etc/ansible/hosts**. This inventory is not world writable and only the **root** user can modify it. For this reason inventories are created by users and the global inventory is not used.

IMPORTANT: Two groups always exists. The **all** group contains all hosts in the inventory. The **ungrouped** host contains every host in inventory which is not part of an inventory group.

[#inventorynestedgroups]
=== Nested groups

Ansible allow to create groups of host groups, nested groups. To create them we need to append **:children** to the group name:

```ini
[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb1.example.com
lb2.example.com

[web-servers]
web1.example.com
web2.example.com
192.168.1.123
192.168.1.124
192.168.1.125

[db-servers]
mysql.example.com

[application:children]
load-balancers
web-servers
db-servers
```

In this case the group **application** will include all hosts belonging to the groups **load-balancers**, **web-servers** and **db-servers**.

[#commonconfiguration]
=== Common configuration

There are configuration which can be common for all or most of the host in the inventory. Instead of including this information in every host ansible provides a way to include that information.

We can add **:vars** to the **all** group and include that configuration:

```ini
[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False
...
```

For all hosts in the inventory the following parameteres will be used:

* **ansible_user=ansible** the connection to the hosts will be done using the **ansible** user.
* **ansible_python_interpreter=/usr/bin/python3** the python interpreter that will be used for ansible in the hosts.
* **host_key_checking=False** ssh keys for the hosts will not be cached.

If we need to modify some of those parameters for some hosts we can do:

```ini
[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb1.example.com ansible_user=admin
lb2.example.com ansible_user=admin

[web-servers]
web1.example.com
web2.example.com
192.168.1.123
192.168.1.124
192.168.1.125

[db-servers]
mysql.example.com

[application:children]
load-balancers
web-servers
db-servers
```

In this case connection to **load-balancers** host groups will be done using the **admin** user instead of the **ansible** user. However, for the rest of the hosts the **ansible** user will be used.

[#usingranges]
=== Using ranges within inventories

Ranges can be used within inventories to simplify them. Ranges are specified using **[START:END]**:

```ini
[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb[1:2].example.com ansible_user=admin

[web-servers]
web[1:2].example.com
192.168.1.12[3:5]

[db-servers]
mysql.example.com

[application:children]
load-balancers
web-servers
db-servers
```

TIP: Leading zeros can be used in numeric ranges **web[01:02].example.com**.

TIP: Ranges can be used with letters as well (**[a:d]**).

[#checkinginventory]
=== Checking the inventory

We can check an inventory to see if the inventory was built correctly.

Create a hosts inventory file with the following content:

```ini
servera.lab.example.com
serverb.lab.example.com
serverc.lab.example.com
serverd.lab.example.com
```

To check:

image::ansible-inventory-01.png[]

IMPORTANT: Server names need to have DNS resolution.

NOTE: If you use groups you can replace the hostname for the group name.

[#steps]
== Steps

1. Create several groups in the inventory file, at least two, and include all the hosts in some group.
   Use a text editor to create a file named **hosts**:
   
   [web]
   servera.lab.example.com
   serverb.lab.example.com
   [bbdd]
   serverc.lab.example.com
   serverd.lab.example.com
   ```
   Execute the following:
   
   $ ansible -i hosts web --list-hosts

   $ ansible -i hosts servera.lab.example.com --list-hosts

2. Modify the above inventory replacing the hostname with the host ip address.
3. Use ranges with the ip addresses you have used to simplify the inventory.
4. Use letters with hostnames to simplify the inventory.

[#usefullinks]
== Useful Links

* https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html
* https://docs.ansible.com/ansible/latest/cli/ansible-inventory.html