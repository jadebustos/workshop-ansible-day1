<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ansible Inventory :: Workshop Ansible (Day 1)</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/course-template/workshop-ansible/03-ansible-inventory.html">
    <link rel="prev" href="02-ansible-adhoc-commands.html#ansibleadhoccommands">
    <link rel="next" href="04-ansible-playbooks.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/course-template">Workshop Ansible (Day 1)</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshop-ansible" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-prerequisites.html">1. Prerequisites</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-prerequisites.html#installingcontrolnode">Installing Control Node</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-prerequisites.html#configuringansibleclients">Configuring Ansible Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-prerequisites.html#validatingansibleconfiguration">Validating Ansible configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-prerequisites.html#usefullinks">Useful Links</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-ansible-adhoc-commands.html#ansibleadhoccommands">2. Ansible AdHocs Commands</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-ansible-adhoc-commands.html#introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-ansible-adhoc-commands.html#steps">Steps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-ansible-adhoc-commands.html#usefullinks">Useful Links</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-ansible-inventory.html">3. Ansible Inventory</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#introduction">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#inventorynestedgroups">Nested Groups</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#commonconfiguration">Common Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#usingranges">Using ranges within inventories</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#checkinginventory">Checking inventory</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#steps">Steps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#usefullinks">Useful Links</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-ansible-playbooks.html">4. Ansible Playbooks</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-ansible-playbooks.html#introduction">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ansible-playbooks.html#firstansibleplaybook">My first ansible playbook</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-ansible-playbooks.html#configureclients">Configure clients to run ansible tasks</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-ansible-playbooks.html#steps">Steps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-ansible-playbooks.html#usefullinks">Useful Links</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Workshop Ansible (Day 1)</a></li>
    <li><a href="03-ansible-inventory.html">3. Ansible Inventory</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/jadebustos/workshop-ansible-day1/edit/master/documentation/modules/ROOT/pages/03-ansible-inventory.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Ansible Inventory</h1>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An inventory defines a collection of hosts that Ansible will manage. These hosts can also be assigned to groups, which can be managed collectively. Groups can contain child groups, and hosts can be members of multiple groups. The inventory can also set variables that apply to the hosts and groups that it defines.</p>
</div>
<div class="paragraph">
<p>Host inventories can be defined in two different ways. A static host inventory can be defined by a text file. A dynamic host inventory can be generated by a script or other program as needed, using external information providers.</p>
</div>
<div class="paragraph">
<p>Inventories are written using INI format. The simplest format is a plain text file with a bunch of hostnames:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">lb1.example.com
lb2.example.com
web1.example.com
web2.example.com
192.168.1.123
mysql.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case all ansible tasks executed using that inventory will be executed in all hosts with no exception. However, if we want to be able to limit the execution of ansible tasks to some of the hosts we can use groups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb1.example.com
lb2.example.com

[web-servers]
web1.example.com
web2.example.com
192.168.1.123
192.168.1.124
192.168.1.125

[db-servers]
mysql.example.com</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Ansible provides a default inventory in <strong>/etc/ansible/hosts</strong>. This inventory is not world writable and only the <strong>root</strong> user can modify it. For this reason inventories are created by users and the global inventory is not used.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Two groups always exists. The <strong>all</strong> group contains all hosts in the inventory. The <strong>ungrouped</strong> host contains every host in inventory which is not part of an inventory group.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="inventorynestedgroups"><a class="anchor" href="#inventorynestedgroups"></a>Nested groups</h3>
<div class="paragraph">
<p>Ansible allow to create groups of host groups, nested groups. To create them we need to append <strong>:children</strong> to the group name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb1.example.com
lb2.example.com

[web-servers]
web1.example.com
web2.example.com
192.168.1.123
192.168.1.124
192.168.1.125

[db-servers]
mysql.example.com

[application:children]
load-balancers
web-servers
db-servers</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the group <strong>application</strong> will include all hosts belonging to the groups <strong>load-balancers</strong>, <strong>web-servers</strong> and <strong>db-servers</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="commonconfiguration"><a class="anchor" href="#commonconfiguration"></a>Common configuration</h3>
<div class="paragraph">
<p>There are configuration which can be common for all or most of the host in the inventory. Instead of including this information in every host ansible provides a way to include that information.</p>
</div>
<div class="paragraph">
<p>We can add <strong>:vars</strong> to the <strong>all</strong> group and include that configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For all hosts in the inventory the following parameteres will be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ansible_user=ansible</strong> the connection to the hosts will be done using the <strong>ansible</strong> user.</p>
</li>
<li>
<p><strong>ansible_python_interpreter=/usr/bin/python3</strong> the python interpreter that will be used for ansible in the hosts.</p>
</li>
<li>
<p><strong>host_key_checking=False</strong> ssh keys for the hosts will not be cached.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If we need to modify some of those parameters for some hosts we can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb1.example.com ansible_user=admin
lb2.example.com ansible_user=admin

[web-servers]
web1.example.com
web2.example.com
192.168.1.123
192.168.1.124
192.168.1.125

[db-servers]
mysql.example.com

[application:children]
load-balancers
web-servers
db-servers</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case connection to <strong>load-balancers</strong> host groups will be done using the <strong>admin</strong> user instead of the <strong>ansible</strong> user. However, for the rest of the hosts the <strong>ansible</strong> user will be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="usingranges"><a class="anchor" href="#usingranges"></a>Using ranges within inventories</h3>
<div class="paragraph">
<p>Ranges can be used within inventories to simplify them. Ranges are specified using <strong>[START:END]</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">[all:vars]
ansible_user=ansible
ansible_python_interpreter=/usr/bin/python3
host_key_checking=False

[load-balancers]
lb[1:2].example.com ansible_user=admin

[web-servers]
web[1:2].example.com
192.168.1.12[3:5]

[db-servers]
mysql.example.com

[application:children]
load-balancers
web-servers
db-servers</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Leading zeros can be used in numeric ranges <strong>web[01:02].example.com</strong>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Ranges can be used with letters as well (<strong>[a:d]</strong>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="checkinginventory"><a class="anchor" href="#checkinginventory"></a>Checking the inventory</h3>
<div class="paragraph">
<p>We can check an inventory to see if the inventory was built correctly.</p>
</div>
<div class="paragraph">
<p>Create a hosts inventory file with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">servera.lab.example.com
serverb.lab.example.com
serverc.lab.example.com
serverd.lab.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ansible-inventory-01.png" alt="ansible inventory 01">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Server names need to have DNS resolution.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use groups you can replace the hostname for the group name.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="steps"><a class="anchor" href="#steps"></a>Steps</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Create several groups in the inventory file, at least two, and include all the hosts in some group.
Use a text editor to create a file named <strong>hosts</strong>:</p>
<div class="literalblock">
<div class="content">
<pre>[web]
servera.lab.example.com
serverb.lab.example.com
[bbdd]
serverc.lab.example.com
serverd.lab.example.com</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Execute the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible -i hosts web --list-hosts</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ansible -i hosts servera.lab.example.com --list-hosts</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Modify the above inventory replacing the hostname with the host ip address.</p>
</li>
<li>
<p>Use ranges with the ip addresses you have used to simplify the inventory.</p>
</li>
<li>
<p>Use letters with hostnames to simplify the inventory.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usefullinks"><a class="anchor" href="#usefullinks"></a>Useful Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html" class="bare">https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/cli/ansible-inventory.html" class="bare">https://docs.ansible.com/ansible/latest/cli/ansible-inventory.html</a></p>
</li>
</ul>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="02-ansible-adhoc-commands.html#ansibleadhoccommands">2. Ansible AdHocs Commands</a></span>
  <span class="next"><a href="04-ansible-playbooks.html">4. Ansible Playbooks</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
